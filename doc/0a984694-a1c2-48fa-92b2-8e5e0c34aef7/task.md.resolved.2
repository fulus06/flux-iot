# FLUX IOT Project Design & Implementation Roadmap

## Phase 0: Project Setup
- [x] Design Project Structure <!-- id: 0 -->
    - [x] Analyze requirements from docs <!-- id: 1 -->
    - [x] Define Rust Workspace structure <!-- id: 2 -->
    - [x] Define Crate boundaries <!-- id: 3 -->
- [x] Implement Project Skeleton <!-- id: 4 -->
    - [x] Create Cargo Workspace <!-- id: 5 -->
    - [x] Create Core Crates (core, server, plugin-api, etc.) <!-- id: 6 -->
    - [x] Define shared Types/Traits <!-- id: 7 -->
- [x] Document Architecture <!-- id: 8 -->
    - [x] Create ARCHITECTURE.md detailed guide <!-- id: 9 -->

## Phase 1: Core Foundation & Types
- [ ] **Data Types Definition** (`flux-types`) <!-- id: 10 -->
    - [ ] Define [Message](file:///Volumes/fushilu/workspace/flux-iot/crates/flux-types/src/message.rs#4-8) struct (Standard Event) <!-- id: 11 -->
    - [ ] Define `DeviceData` and `Command` structs <!-- id: 12 -->
    - [ ] Fix Wasm compatibility for `flux-types` (handle `uuid`/`getrandom` issues) <!-- id: 13 -->
- [ ] **Event Bus** (`flux-core`) <!-- id: 14 -->
    - [ ] Implement async `EventBus` using tokio broadcast/mpsc <!-- id: 15 -->
    - [ ] Define Subscriber/Publisher traits <!-- id: 16 -->

## Phase 2: Plugin System (Wasmtime)
- [ ] **Plugin Host Implementation** (`flux-plugin`) <!-- id: 17 -->
    - [ ] Configure Wasmtime Engine (Enable Epoch interruption for safety) <!-- id: 18 -->
    - [ ] Implement Memory Bridge (Shared Memory for passing strings/bytes) <!-- id: 19 -->
    - [ ] Implement [PluginManager](file:///Volumes/fushilu/workspace/flux-iot/crates/flux-plugin/src/lib.rs#1-2) to load/unload `.wasm` files <!-- id: 20 -->
- [ ] **Plugin SDK** (`flux-plugin-sdk`) <!-- id: 21 -->
    - [ ] Create convenience macros (`export_plugin!`) <!-- id: 22 -->
    - [ ] Example: Implement a `dummy_plugin` for testing <!-- id: 23 -->

## Phase 3: Script Engine (Rhai)
- [ ] **Script Engine Implementation** (`flux-script`) <!-- id: 24 -->
    - [ ] Configure `rhai::Engine` with safety limits (max operations) <!-- id: 25 -->
    - [ ] Register `flux-types` into Rhai Scope <!-- id: 26 -->
    - [ ] Implement `ScriptService` for hot-reloading scripts <!-- id: 27 -->

## Phase 4: Server Integration & API
- [ ] **Server Application** (`flux-server`) <!-- id: 28 -->
    - [ ] Wire up EventBus, PluginManager, and ScriptEngine <!-- id: 29 -->
    - [ ] Implement Configuration Loading (`config.toml`) <!-- id: 30 -->
    - [ ] Basic HTTP API (Axum) for status checks <!-- id: 31 -->
