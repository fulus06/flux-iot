# FLUX IOT 视频监控系统开发规划

**版本**: v1.0  
**制定日期**: 2026年02月11日  
**预计工期**: 6-8 周  
**状态**: 进行中

---

## 总体规划

### 开发目标

构建一个**极致轻量、高并发**的视频流监控系统：
- ✅ 单节点模式：40-80MB 内存，支持 100+ 路摄像头
- ✅ 分布式模式：支持地理分布式部署
- ✅ 多协议支持：RTSP、RTMP、GB28181、WebRTC
- ✅ 灵活存储：本地/NAS/NVR/云存储

### 开发策略

- **渐进式交付**：每个 Milestone 独立可用
- **测试驱动**：每个模块都有单元测试
- **性能优先**：持续进行性能基准测试
- **文档同步**：代码和文档同步更新

---

## Milestone 1: 核心能力（2周）

**目标**：交付可用的 RTSP 监控系统

### M1.1: 创建 flux-video crate 基础结构 ✅

**工期**: 1 天 | **状态**: ✅ 已完成

**产出**：17个模块文件，编译通过

---

### M1.2: 实现存储层单节点模式

**工期**: 3 天 | **状态**: 🔄 进行中

**任务**：
- [ ] 实现 `StandaloneStorage` 完整功能
- [ ] 实现 `WritePipeline` 零拷贝流水线
- [ ] 实现 `LightweightIndex` LRU 缓存
- [ ] 添加单元测试

**验收标准**：
- 支持 10-100 路并发写入
- 内存占用 < 80MB
- 单元测试通过

---

### M1.3: 实现 RTSP 协议支持

**工期**: 3 天 | **状态**: ⏳ 待开始

**任务**：
- [ ] 集成 `retina` crate
- [ ] 实现 `RtspStream` 完整功能
- [ ] 实现流生命周期管理
- [ ] 添加集成测试

---

### M1.4: 实现关键帧提取

**工期**: 2 天 | **状态**: ⏳ 待开始

**任务**：
- [ ] 实现 H.264 NALU 解析
- [ ] 实现 `KeyframeExtractor`
- [ ] 零拷贝提取
- [ ] 添加单元测试

---

### M1.5: 实现基础 HTTP API

**工期**: 1 天 | **状态**: ⏳ 待开始

**任务**：
- [ ] 创建 HTTP API 模块
- [ ] 集成到 `flux-server`
- [ ] 编写集成测试
- [ ] 编写用户文档

---

## Milestone 2: GB28181 协议（2周）

**目标**：支持国标设备

### M2.1: 实现 GB28181 SIP 信令层

**工期**: 5 天 | **状态**: ⏳ 待开始

---

### M2.2: 实现 RTP 接收和 PS 流解封装

**工期**: 5 天 | **状态**: ⏳ 待开始

---

### M2.3: 实现多存储后端

**工期**: 2 天 | **状态**: ⏳ 待开始

---

## Milestone 3: 性能优化（2-4周）

**目标**：生产级平台

### M3.1: io_uring 和 Direct I/O 优化

**工期**: 3 天 | **状态**: ⏳ 待开始

---

### M3.2: 分布式模式

**工期**: 5 天 | **状态**: ⏳ 待开始

---

### M3.3: 监控指标

**工期**: 3 天 | **状态**: ⏳ 待开始

---

### M3.4: 性能测试

**工期**: 3-5 天 | **状态**: ⏳ 待开始

---

## 验收标准

### 性能指标

| 指标 | 单节点模式 | 分布式模式 |
|------|-----------|-----------|
| **并发能力** | 100+ 路 | 200+ 路 |
| **内存占用** | < 256 MB | < 512 MB |
| **CPU 占用** | < 30% | < 60% |
| **I/O 吞吐** | > 200 MB/s | > 400 MB/s |

### 质量标准

- ✅ 单元测试覆盖率 > 60%
- ✅ 无 `unwrap()` 或 `expect()`
- ✅ `cargo clippy` 无警告
- ✅ 压力测试通过（1 小时）

---

## 当前进度

- **当前 Milestone**: Milestone 1
- **当前任务**: M1.2 - 实现存储层单节点模式
- **完成度**: 6.7% (1/15 任务)
- **预计完成时间**: 2026年03月底

---

**文档版本**: v1.0  
**最后更新**: 2026年02月11日  
**维护者**: FLUX IOT 开发团队
