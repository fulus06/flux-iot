#!/bin/bash
# FLUX IOT Pre-commit Hook
# ç¡®ä¿ä»£ç è´¨é‡ï¼šæ ¼å¼åŒ–ã€Clippy æ£€æŸ¥ã€æµ‹è¯•

set -e

echo "ğŸ” Running pre-commit checks..."

# 1. è¿è¡Œ cargo fmt æ£€æŸ¥
echo "ğŸ“ Checking code formatting..."
if ! cargo fmt --all -- --check; then
    echo "âŒ Code formatting check failed!"
    echo "ğŸ’¡ Run 'cargo fmt --all' to fix formatting issues"
    exit 1
fi
echo "âœ… Code formatting OK"

# 2. è¿è¡Œ cargo clippy
echo "ğŸ”§ Running Clippy..."
if ! cargo clippy --all-targets -- -D warnings; then
    echo "âŒ Clippy check failed!"
    echo "ğŸ’¡ Fix the warnings above before committing"
    exit 1
fi
echo "âœ… Clippy check OK"

# 3. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª Running tests..."
if ! cargo test --workspace --quiet; then
    echo "âŒ Tests failed!"
    echo "ğŸ’¡ Fix the failing tests before committing"
    exit 1
fi
echo "âœ… All tests passed"

echo "âœ¨ All pre-commit checks passed!"
exit 0
