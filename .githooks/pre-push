#!/bin/bash
# FLUX IOT Pre-push Hook
# è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶å’Œæ„å»ºæ£€æŸ¥

set -e

echo "ğŸš€ Running pre-push checks..."

# 1. è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆåŒ…æ‹¬é›†æˆæµ‹è¯•ï¼‰
echo "ğŸ§ª Running full test suite..."
if ! cargo test --workspace; then
    echo "âŒ Test suite failed!"
    exit 1
fi
echo "âœ… Test suite passed"

# 2. æ£€æŸ¥ release æ„å»º
echo "ğŸ—ï¸  Checking release build..."
if ! cargo build --release --workspace; then
    echo "âŒ Release build failed!"
    exit 1
fi
echo "âœ… Release build OK"

# 3. è¿è¡Œ cargo check
echo "ğŸ” Running cargo check..."
if ! cargo check --workspace; then
    echo "âŒ Cargo check failed!"
    exit 1
fi
echo "âœ… Cargo check OK"

echo "âœ¨ All pre-push checks passed!"
exit 0
